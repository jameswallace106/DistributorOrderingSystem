<!-- app/views/orders/index.html.erb -->
<%= render 'shared/navbar' %>

<div class="home">
  <div class="table-card">
    <div class="table-header">
      <h2>Orders</h2>
      <% unless current_user.is_admin? %>
        <%= link_to "New Order",
              new_order_path,
              class: "btn-add",
              data: { turbo_frame: "modal-order" } %>
      <% end %>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Distributor</th>
          <th>Delivery Date</th>
          <th>Status</th>
          <th>Total</th>
          <% unless current_user.is_admin? %>
            <th></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% @orders.each do |order| %>
          <tr>
            <td><%= order.id %></td>
            <td><%= order.distributor.name %></td>
            <td><%= order.required_delivery_date&.strftime("%m/%d/%Y") %></td>
            <td>
              <span class="status-badge status-<%= order.status %>">
                <%= order.status.titleize %>
              </span>
            </td>
            <td><%= sprintf("%.2f", order.total_cost) %></td>
            <% unless current_user.is_admin? %>
              <td class="actions">
                <% if order.in_progress? %>
                  <%= link_to "Configure",
                        configure_order_path(order),
                        class: "btn-action",
                        data: { turbo_frame: "modal-order" } %>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
        <% if @orders.empty? %>
          <tr>
            <td colspan="<%= current_user.is_admin? ? 7 : 8 %>" class="empty-row">No orders found</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<turbo-frame id="modal-order-new"></turbo-frame>
<turbo-frame id="modal-order"></turbo-frame>

<script>
    document.addEventListener("click", (e) => {
    if (e.target.classList.contains("modal-close")) {
      const modal = document.getElementById("modal-order");
      if (modal) {
        modal.innerHTML = "";
      }
      const modalNew = document.getElementById("modal-order-new");
      if (modalNew){
        modalNew.innerHTML = "";
      }
      const modalNewItem = document.getElementById("modal-item-new");
      if (modalNewItem){
        modalNewItem.innerHTML = "";
      }
    }
  });
</script>